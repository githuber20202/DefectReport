# אפיון טכני - מערכת דיווח תקלות

## 1. מבוא

מערכת דיווח תקלות נועדה לאפשר למשתמשים לדווח על תקלות, לבקש הרשאות או להציע שיפורים למערכת. המערכת מתאימה למגוון רחב של משתמשים (משתמשים רגילים, מנהלים, וצוותים טכניים) ומאפשרת ניהול גמיש של סוגי הפניות והמודולים, שמירת נתונים למעקב וניתוח, והפקת דוחות וניתוח סטטיסטי (BI ראשוני) בצורה נוחה. המערכת תאפשר שימוש בסביבה גמישה כך שניתן יהיה להחליף שרתים ולבצע התאמות ללא שינוי קוד משמעותי.

## 2. מטרות המערכת

* **קלות שימוש:** טופס נגיש למילוי דיווחים עם חוויית משתמש נוחה ואינטואיטיבית.
* **גמישות דינמית:** התאמה לשינויים באמצעות קובץ קונפיגורציה.
* **תיעוד ושמירת מידע:** שמירת הנתונים למעקב וניתוח במסד נתונים או קובץ.
* **יצוא נתונים:** אפשרות ייצוא נתונים לקובץ Excel.
* **התאמה למספר מערכות שונות:** כל מערכת בעלת מודולים מותאמים.
* **מניעת דיווחים כפולים:** זיהוי כפילויות והתרעה מתאימה.
* **תמיכה בהחלפת שרתים:** קונפיגורציה דינמית לסביבות עבודה שונות.
* **הקטנת זמני תגובה:** שיפור תהליכי הטיפול בתקלות וטיפול מהיר בהן.

## 3. מבנה כללי של המערכת

### 3.1. ממשק משתמש (Frontend)

ממשק המשתמש יתבסס על טכנולוגיות HTML, CSS, JavaScript (Vanilla/React) ויאפשר ממשק אינטואיטיבי שמאפשר למשתמשים ללא רקע טכני לבצע דיווחים בקלות ובנוחות:

* **טופס דיווח הכולל:**

   1. **שם מדווח** - שדה חופשי לקבלת טקסט מכל סוג.
   
   2. **תאריך דיווח** - **לא יוצג בטופס**, יתווסף אוטומטית בקובץ ה-Excel כ-Timestamp.
   
   3. **שם המערכת** - רשימה נפתחת עם אפשרות לבחור בין 10 מערכות (מערכת 1 עד מערכת 10).
   
   4. **סיבת הפנייה** - רשימה נפתחת עם 3 אפשרויות:
      * **תקלה** - יפתח שדה טקסט חופשי עם כותרת: "תיאור שחזור התקלה".
      * **בקשת הרשאות** - יפתח שדה טקסט חופשי עם כותרת: "הכנס בקשה מפורטת לקבלת הרשאה".
      * **הצעת ייעול** - יפתח שדה טקסט חופשי עם כותרת: "הכנס את הצעת הייעול בצורה מפורטת".
   
   5. **מודול מערכת** - הרשימה הנפתחת תשתנה בהתאם למערכת שנבחרה:
      * אם נבחרה מערכת 1: האפשרויות יהיו "מפה", "התראות", "מסננים".
      * אם נבחרה מערכת 2: האפשרויות יהיו "מפה 2", "התראות 2", "מסננים 2".
      * וכן הלאה לכל 10 המערכות.
   
   6. **כפתור שליחת דיווח**
   
   7. **כפתור הורדת קובץ תקלות Excel**

* **התנהגות דינמית בטופס (Best Practices):**

   * **מדרג מילוי שדות חובה עם תלויות:**
     * טופס הדיווח יאלץ מילוי שדות בסדר לוגי עם הגבלות תלות:
     * **שלב ראשון:** מילוי "שם מדווח" - שדה חובה לפני המשך. כל השדות הבאים יהיו מושבתים.
     * **שלב שני:** אחרי מילוי שם המדווח, יופעל שדה "שם המערכת" לבחירה. שאר השדות עדיין מושבתים.
     * **שלב שלישי:** אחרי בחירת מערכת, יופעל שדה "סיבת הפנייה". שאר השדות עדיין מושבתים.
     * **שלב רביעי:** אחרי בחירת סיבת הפנייה, יופעל שדה "מודול מערכת" עם האפשרויות הרלוונטיות למערכת שנבחרה.
     * **שלב חמישי:** אחרי בחירת מודול, יופעל שדה הטקסט החופשי המתאים לסיבת הפנייה.
     * **שלב שישי:** רק לאחר מילוי כל השדות הנדרשים, יופעל כפתור "שלח דיווח".
   
   * **חיווי ויזואלי לתהליך:**
     * שדות פעילים יסומנו בצבע בולט או תאורה.
     * שדות לא זמינים יהיו באפור (מושבתים) עם הסבר קצר "מלא קודם את השדות הקודמים".
     * סרגל התקדמות עליון יציג את מיקום המשתמש בתהליך (שלב X מתוך 6).
     * כל שלב שהושלם יסומן ב-✓ (וי) ירוק לציון השלמתו.

   * **הצגת שדות חופשיים בהתאם לסיבת הפנייה:**
     * אם נבחרה "תקלה" יוצג שדה "תיאור שחזור התקלה".
     * אם נבחרה "בקשת הרשאות" יוצג שדה "הכנס בקשה מפורטת לקבלת הרשאה".
     * אם נבחרה "הצעת ייעול" יוצג שדה "הכנס את הצעת הייעול בצורה מפורטת".
     * במידה והמשתמש משנה את סוג הפנייה - השדה החופשי יתעדכן בהתאם **ורק הערך הרלוונטי יישמר**.

   * **סינון דינמי של מודול מערכת:**
     * הבחירות במודול יוצגו **בהתאם למערכת שנבחרה**.
     * ברירת מחדל - "הכל".
     
   * **ולידציות בזמן אמת:**
     * טקסט עזרה מתאים יופיע מתחת לכל שדה המסביר את דרישות המינימום.
     * שגיאות ולידציה יופיעו מיד כשהמשתמש עובר לשדה הבא (לא בלחיצה על "שלח").
     * לחצן השליחה יהיה פעיל רק כאשר כל הולידציות עוברות בהצלחה.

### 3.2. ממשק ניהול (Backend)

ממשק הניהול יתבסס על Node.js (Express.js) ויכלול:

* **API דינמי לקונפיגורציה** (טעינת נתונים מתוך `config.json`)
* **API לשמירת דיווחי תקלות** תוך בדיקת כפילות
* **API להורדת קובץ Excel** עם כל הדיווחים
* **אימות ובקרת גישה** לממשק ניהול עם תמיכה בהרשאות לפי תפקידים
* **מנגנון לניהול ותיעוד לוגים** לשינויים בקונפיגורציה לצורכי Audit Trail
* **תמיכה בבחירת שרת דינמית** בהתאם לסביבה (`githubPages`, `local`, `production`)

## 4. מבנה הנתונים

### 4.1. קובץ קונפיגורציה (config.json)

```json
{
  "environments": {
    "githubPages": "https://defectreport.onrender.com",
    "local": "http://localhost:3000",
    "production": "https://api.myproductionserver.com"
  },
  "systems": {
    "מערכת 1": ["מפה", "התראות", "מסננים"],
    "מערכת 2": ["מפה 2", "התראות 2", "מסננים 2"],
    "מערכת 3": ["מפה 3", "התראות 3", "מסננים 3"],
    "מערכת 4": ["מפה 4", "התראות 4", "מסננים 4"],
    "מערכת 5": ["מפה 5", "התראות 5", "מסננים 5"],
    "מערכת 6": ["מפה 6", "התראות 6", "מסננים 6"],
    "מערכת 7": ["מפה 7", "התראות 7", "מסננים 7"],
    "מערכת 8": ["מפה 8", "התראות 8", "מסננים 8"],
    "מערכת 9": ["מפה 9", "התראות 9", "מסננים 9"],
    "מערכת 10": ["מפה 10", "התראות 10", "מסננים 10"]
  },
  "criticalAlertThreshold": {
    "reportCount": 3,
    "timeframeHours": 24
  },
  "authorizedAdmins": [
    "admin1@domain.com",
    "admin2@domain.com"
  ],
  "allowedAttachmentTypes": ["png", "jpg", "jpeg", "pdf", "txt", "log"]
}
```

### 4.2. מבנה דיווחי תקלות (bugReports.json / MongoDB / PostgreSQL)

המערכת תתמוך במספר אפשרויות לשמירת נתונים, כולל:
* קבצי JSON
* בסיס נתונים MongoDB
* בסיס נתונים רלציוני כמו PostgreSQL

להלן מבנה הנתונים:

```json
[
  {
    "reporterName": "משתמש א",
    "systemName": "מערכת 1",
    "reason": "תקלה",
    "module": "מפה",
    "description": "המערכת קורסת בעת טעינת מפה",
    "timestamp": "2025-03-07T10:00:20.178Z"
  },
  {
    "reporterName": "משתמש ב",
    "systemName": "מערכת 2",
    "reason": "בקשת הרשאות",
    "module": "התראות 2",
    "description": "אני צריך גישה למודול התראות 2 עבור פרויקט X",
    "timestamp": "2025-03-06T14:30:15.432Z",
    "attachments": []
  },
  {
    "reporterName": "משתמש ג",
    "systemName": "מערכת 3",
    "reason": "הצעת ייעול",
    "module": "מסננים 3",
    "description": "הצעה לשיפור ממשק המסננים כך שיהיה יותר אינטואיטיבי",
    "timestamp": "2025-03-05T09:15:45.789Z",
    "attachments": ["suggestion_mockup.png"]
  }
]
```

## 5. API Backend

### 5.1. נתיבים (Endpoints)

| מתודה | נתיב | תיאור |
|--------|--------|--------|
| GET | /config | שליפת קובץ הקונפיגורציה |
| POST | /submitBugReport | שמירת דיווח תקלה חדש |
| GET | /downloadExcel | הורדת כל הדיווחים בקובץ Excel |
| GET | /getReports | שליפת דיווחים עם אפשרויות סינון |
| GET | /getAuditLogs | שליפת לוגים של שינויים במערכת (למנהלים) |

### 5.2. פירוט הנתיבים

#### GET /config
- **תיאור**: מחזיר את קובץ הקונפיגורציה עם רשימת המערכות והמודולים
- **פרמטרים**: אין
- **אבטחה**: ללא הרשאות מיוחדות
- **תשובה**: קובץ JSON של הקונפיגורציה

#### POST /submitBugReport
- **תיאור**: שומר דיווח תקלה חדש
- **פרמטרים**: JSON עם פרטי הדיווח
- **אבטחה**: ולידציה מלאה של כל השדות למניעת XSS ו-SQL Injection
- **גוף הבקשה**:
  ```json
  {
    "reporterName": "string",
    "systemName": "string",
    "reason": "string",
    "module": "string",
    "description": "string"
  }
  ```
- **תשובה**: סטטוס הצלחה/כישלון עם מזהה ייחודי של הדיווח



#### GET /downloadExcel
- **תיאור**: מאפשר הורדת כל הדיווחים בקובץ Excel
- **פרמטרים**: אופציונלי - מסננים לפי תאריך, מערכת, סוג תקלה
- **אבטחה**: דורש הרשאות מנהל
- **תשובה**: קובץ Excel להורדה

#### GET /getReports
- **תיאור**: שליפת דיווחים עם אפשרויות סינון
- **פרמטרים**: מסננים לפי תאריך, מערכת, סוג תקלה
- **אבטחה**: דורש הרשאות מנהל
- **תשובה**: רשימת דיווחים בפורמט JSON

#### GET /getAuditLogs
- **תיאור**: שליפת לוגים של שינויים במערכת
- **פרמטרים**: מסננים לפי תאריך, סוג פעולה, משתמש
- **אבטחה**: דורש הרשאות מנהל מתקדמות
- **תשובה**: רשימת פעולות Audit בפורמט JSON

## 6. תהליך עבודה

1. המשתמש ממלא את טופס הדיווח לפי התהליך הליניארי:
   - מזין שם מדווח (שדה חובה)
   - בוחר את המערכת הרלוונטית (נפתח רק לאחר מילוי השדה הקודם)
   - בוחר את סיבת הפנייה (תקלה/בקשת הרשאות/הצעת ייעול)
   - בוחר את המודול הרלוונטי (מוצגות רק האפשרויות הרלוונטיות למערכת שנבחרה)
   - ממלא את שדה התיאור המתאים לסיבת הפנייה
   - מעלה קבצים רלוונטיים לפי הצורך (צילומי מסך, לוגים וכו')

2. המשתמש לוחץ על כפתור "שלח" (פעיל רק כשכל השדות תקינים).

3. המערכת מבצעת:
   - ולידציה מלאה של הנתונים
   - בדיקת כפילויות מול דיווחים קיימים
   - שמירת הדיווח במסד הנתונים עם חותמת זמן אוטומטית

4. מנהל המערכת יכול:
   - לגשת לממשק הניהול לצפייה בדיווחים
   - לסנן ולחפש דיווחים לפי קריטריונים שונים
   - להוריד את כל הדיווחים או את הדיווחים המסוננים בקובץ Excel
   - לצפות בלוגים של שינויים במערכת (Audit Trail)

5. ניהול קונפיגורציה:
   - עדכון מערכות ומודולים דרך קובץ קונפיגורציה
   - שינוי הגדרות סביבה ושרתים ללא צורך בשינוי קוד
   - ניהול משתמשים והרשאות

## 7. שיקולים טכניים

### 7.1. תשתית ופיתוח

* **ניהול דינמי של קונפיגורציה** דרך config.json
* **תמיכה בדפדפנים מודרניים** Chrome, Edge, Firefox, Safari
* **תמיכה בגישה מניידים** באמצעות Responsive Design
* **בדיקת כפילויות** למניעת דיווחים חוזרים
* **החלפת שרתים** באמצעות הגדרות בקובץ קונפיגורציה

### 7.2. אבטחת מידע

* **מנגנון חזק של ולידציית קלט ואבטחה** כולל שימוש ב-middlewares נפוצים:
  * **Helmet.js** להגנה מפני התקפות נפוצות כמו XSS, clickjacking
  * **express-validator** לוולידציה של כל קלט משתמש
  * **csurf** להגנה מפני CSRF
* **הגנה מפני SQL Injection** באמצעות Prepared Statements או ORM
* **סריקת קבצים מועלים** למניעת העלאת קבצים זדוניים
* **תיעוד פעולות (Audit Trail)** לכל שינוי במערכת
* **בדיקות אבטחה תקופתיות (Penetration Testing)** בהתאם לצורך

### 7.3. ביצועים וזמינות

* **קשיחות (Resilience)** - המשך פעולה גם בתנאי עומס
* **ביצועים** - זמני תגובה מהירים לממשק המשתמש
* **זמינות גבוהה** - מינימום זמני השבתה לתחזוקה
* **גיבוי נתונים** - גיבוי אוטומטי ושחזור במקרה של תקלה

## 8. חוויית משתמש (UX)

### 8.1. הנחיות לתהליך מילוי הטופס

* **תהליך מובנה וליניארי:**
  * המשתמש יונחה בצורה ברורה דרך תהליך מילוי הטופס בשלבים מובנים.
  * כל שדה יהיה זמין רק לאחר שהשדות הקודמים לו מולאו כהלכה.
  * תרשים זרימה פשוט יוצג בחלק העליון של הטופס להמחשת התקדמות התהליך.

* **הנחיות משתמש ברורות:**
  * כל שדה יכלול טקסט הסבר קצר ובהיר המתאר את מה שנדרש.
  * טיפים (tooltips) יוצגו כאשר המשתמש מרחף מעל שדה להסברים מעמיקים יותר.
  * דוגמאות למילוי נכון יוצגו בתוך השדות כפלייסהולדרים (placeholders).

* **משוב מיידי:**
  * אימות שדות בזמן אמת עם חיווי ויזואלי ברור (ירוק לתקין, אדום לשגוי).
  * הודעות שגיאה ספציפיות המסבירות בדיוק מה צריך לתקן.
  * חיווי הצלחה מובחן לאחר שליחת הטופס, כולל סיכום הפרטים שנשלחו.

### 8.2. עיצוב חזותי והנגשה

* **עיצוב נקי ומקצועי:**
  * צבעוניות קלה ומאוזנת המתאימה לזהות הארגונית.
  * מרווחים נוחים בין השדות למניעת תחושת עומס.
  * היררכיה ויזואלית ברורה עם כותרות ותתי-כותרות מובחנות.

* **התאמה למובייל (Responsive Design):**
  * תצוגה מותאמת אוטומטית לגדלי מסך שונים.
  * אופטימיזציה לשימוש במכשירים ניידים עם כפתורים בגודל נוח למגע.
  * סידור שדות בטור בודד בתצוגת מובייל לנוחות גלילה.

* **נגישות:**
  * תמיכה מלאה בתקני נגישות WCAG 2.1 ברמה AA.
  * תיאורי ARIA לתמיכה בקוראי מסך.
  * ניגודיות צבעים מספקת עבור משתמשים עם לקויות ראייה.
  * אפשרות ניווט מלאה באמצעות המקלדת.

## 9. תכנון יישום והטמעה

### 9.1. גישת פיתוח

* **פיתוח איטרטיבי:**
  * שלב 1: ממשק משתמש בסיסי עם תמיכה בסוגי תקלות ומודולים קבועים
  * שלב 2: הוספת תמיכה בקונפיגורציה דינמית
  * שלב 3: הוספת יכולות העלאת קבצים וייצוא Excel
  * שלב 4: שיפור UX/UI ותהליך משתמש מובנה
  * שלב 5: הוספת ניהול משתמשים והרשאות מתקדמות

* **תהליך בדיקות מקיף:**
  * בדיקות יחידה אוטומטיות לכל רכיב
  * בדיקות אינטגרציה בין המודולים
  * בדיקות קבלה מול דרישות האפיון
  * בדיקות שמישות עם משתמשי קצה
  * בדיקות עומסים וביצועים

### 9.2. דרישות תשתית

* **דרישות חומרה מינימליות:**
  * שרת: 2 ליבות CPU, 4GB RAM, 50GB אחסון
  * רוחב פס: 10Mbps מינימום
  * תמיכה בגיבוי אוטומטי יומי

* **דרישות תוכנה:**
  * מערכת הפעלה: Linux (Ubuntu Server 20.04 LTS או חדש יותר)
  * Node.js גרסה 14 ומעלה
  * MongoDB 4.4 ומעלה (אם נבחר MongoDB כפתרון האחסון)
  * PostgreSQL 13 ומעלה (אם נבחר PostgreSQL כפתרון האחסון)
  * Nginx או Apache כשרת פרוקסי הפוך
  * HTTPS עם אישור SSL תקף

### 9.3. תחזוקה שוטפת

* **גיבוי נתונים:**
  * גיבוי אוטומטי יומי של מסד הנתונים
  * גיבוי מלא שבועי של כל המערכת
  * שמירת גיבויים למשך 90 יום לפחות

* **ניטור ביצועים:**
  * ניטור זמני תגובה של שרת ה-API
  * ניטור שימוש במשאבי מערכת (CPU, RAM, דיסק)
  * התראות אוטומטיות במקרה של חריגות

* **עדכוני תוכנה:**
  * עדכוני אבטחה שוטפים
  * עדכוני ספריות וחבילות
  * תכנון שדרוגים גדולים והתאמות עתידיות

## 10. אפשרויות הרחבה עתידיות

* **שיפור תצוגת הממשק באמצעות React**
* **הוספת דשבורדים וויזואליזציות לניתוח תקלות**
* **מנגנון למעקב אחר סטטוס הטיפול בתקלות**
* **התראות אוטומטיות למנהלים על תקלות קריטיות**
* **אינטגרציה עם מערכות ניהול פרויקטים (Jira, Monday.com, וכו')**
* **יישום מנגנוני בינה מלאכותית לניתוח תקלות חוזרות וזיהוי מגמות**
* **אפשרות לנהל בסיס ידע של פתרונות לתקלות נפוצות**
* **הרחבת תמיכה לשפות נוספות (לוקליזציה)**
* **פיתוח יישומון (אפליקציה) למובייל לדיווח תקלות בשטח**
* **הוספת צ'אט בזמן אמת לתמיכה מיידית למשתמשים**
* **צירוף קבצים לדיווח** - פיתוח יכולת להעלאת צילומי מסך, קבצי לוג וקבצים נוספים לצורך תיעוד וניתוח מעמיק של התקלות

## 11. סיכום

אפיון זה מהווה בסיס מקיף ומפורט לפיתוח מערכת דיווח תקלות מודרנית, גמישה וידידותית למשתמש. המערכת תאפשר דיווח יעיל על תקלות, בקשות הרשאה והצעות ייעול, תוך מתן חוויית משתמש מונחית ואינטואיטיבית. האפיון מתייחס לכל ההיבטים הנדרשים ליישום מוצלח, החל מממשק המשתמש, דרך תשתית טכנית ועד לשיקולי אבטחה, ביצועים ותחזוקה.

יתרונותיה המרכזיים של המערכת:
* **תהליך דיווח מובנה וברור** - תהליך ליניארי עם תלויות בין שדות המנחה את המשתמש באופן אינטואיטיבי
* **גמישות מרבית** - ניהול דינמי של מערכות ומודולים באמצעות קובץ קונפיגורציה
* **תמיכה במגוון סוגי פניות** - תקלות, בקשות הרשאה והצעות ייעול במערכת אחידה
* **אבטחה חזקה** - מנגנונים מובנים למניעת התקפות נפוצות
* **יכולת צירוף קבצים** - העשרת הדיווחים בצילומי מסך וקבצי לוג לטיפול יעיל יותר
* **ייצוא וניתוח נתונים** - אפשרות להורדת דוחות Excel ולניתוח מגמות

המערכת תאפשר לצוותי הפיתוח והתמיכה לטפל בתקלות ביעילות רבה יותר, לשפר את זמני התגובה, ולהעלות את רמת שביעות הרצון של המשתמשים.